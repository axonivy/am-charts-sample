<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
	<ui:composition template="/layouts/basic-8.xhtml">
		<ui:define name="title">DialogWithChart</ui:define>
		<ui:define name="content">

			<h3>Included amCharts4 diagram</h3>
			<h:outputScript library="ivy-webcontent" name="js/core.js" />
			<h:outputScript library="ivy-webcontent" name="js/maps.js" />
			<h:outputScript library="ivy-webcontent" name="js/geodata/worldLow.js" />
			
			
			<div id="chartdiv" style="width: 1000px; height: 700px;"></div>

			<script>
				// Create chart instance
				var map = am4core.create("chartdiv", am4maps.MapChart);
				map.geodata = am4geodata_worldLow;
				map.projection = new am4maps.projections.Mercator();

				var polygonSeries = new am4maps.MapPolygonSeries();
				polygonSeries.useGeodata = true;
				map.series.push(polygonSeries);
				polygonSeries.exclude = ["AQ"]; // exclude antarctica from map
			
				// load data from REST service in Json format
				polygonSeries.dataSource.url = "/ivy/api/#{ivy.request.getApplication().getName()}/datas/countries";				
				
				// configure series
				var polygonTemplate = polygonSeries.mapPolygons.template;
				polygonTemplate.tooltipText = "{name}: {value}";
				polygonTemplate.fill = am4core.color("#c7d426");
				
				// create hover state and set alternative fill color
				var hs = polygonTemplate.states.create("hover");
				hs.properties.fill = am4core.color("#007095");
				polygonTemplate.propertyFields.fill = "fill";

				// add image series
				var imageSeries = map.series.push(new am4maps.MapImageSeries());
				var imageSeriesTemplate = imageSeries.mapImages.template;
				var circle = imageSeriesTemplate.createChild(am4core.Circle);
				circle.radius = 4;
				circle.fill = am4core.color("#00000");
				circle.stroke = am4core.color("#FFFFFF");
				circle.strokeWidth = 2;
				circle.nonScaling = true;
				circle.tooltipText = "{title}  ({latitude}; {longitude})";

				// bind latitude and longitude properties
				imageSeriesTemplate.propertyFields.latitude = "latitude";
				imageSeriesTemplate.propertyFields.longitude = "longitude";

				// image series data
				imageSeries.data = [ {
					"latitude" : 40.712775,
					"longitude" : -74.005973,
					"title" : "New York"
				}, {
					"latitude" : 47.166168,
					"longitude" : 8.515495,
					"title" : "Zug"
				} ];
				// add line series
				var lineSeries = map.series.push(new am4maps.MapLineSeries());
				lineSeries.data = [ {
					"multiGeoLine" : [ [ {
						"latitude" : 40.712775,
						"longitude" : -74.005973
					}, {
						"latitude" : 47.166168,
						"longitude" : 8.515495
					} ] ]
				} ];
				// line apperance
				lineSeries.mapLines.template.line.stroke = am4core.color("#007095");
				lineSeries.mapLines.template.line.strokeOpacity = 0.8;
				lineSeries.mapLines.template.line.strokeWidth = 4;
				lineSeries.mapLines.template.line.strokeDasharray = "3,3";
			</script>


			<h:form id="form">
				<p:panelGrid columns="1" layout="grid"
					styleClass="ui-panelgrid-blank"
					columnClasses="ui-g-12 ui-md-3 ui-lg-2, 
						ui-g-12 ui-md-9 ui-lg-4, 
						ui-g-12 ui-md-3 ui-lg-2, 
						ui-g-12 ui-md-9 ui-lg-4">
					<f:facet name="header">
						<p:messages></p:messages>
					</f:facet>
					<p:commandButton actionListener="#{logic.close}" value="Close"
						update="form" icon="ui-icon-check" />
				</p:panelGrid>
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>